<html>
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!-- Our Custom CSS -->
    <link rel="stylesheet" type="text/css" href="stylesheets/style.css">

    <!-- Font Awesome JS -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js" integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ" crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js" integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY" crossorigin="anonymous"></script>

    <title>Abacus</title>
  </head>

  <body>
    <div class="wrapper">

      <!-- Sidebar -->
      <nav id="sidebar">
        <ul class="list-unstyled components">
          <li class="active">
            <a href="index.html">Dashboard</a>
          </li>
          <li>
            <a href="#">Use Cases</a>
          </li>
          <li>
            <a href="about.html">About Abacus</a>
          </li>
        </ul>
      </nav>

      <!-- Page Content -->
      <div id="content" class="page-container">
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
          <div class="container-fluid page-header">

            <button type="button" id="sidebarCollapse" class="btn btn-light grey-collapse">
              <i class="fa fa-bars"></i>
            </button>
            <h4 style="text-align: center; font-weight: 200;">ａｂａｃｕｓ<h4>

          </div>
        </nav>
        <div class="container-fluid page-content">
          <div class="container">
            <div class="row">
              <div class="card info-card" style="width: 22rem;">
                <div class="card-body">
                  <h5 class="card-title">Status</h5>
                  <h6 class="card-subtitle mb-2 text-muted">Estimated Total Use Case Count: <span id="total"></span></h6>
                  <p class="card-text">
                    <ul class="list-unstyled">
                      <li>
                        Use Cases Written: <span id="use-cases"/> <span id="use-case-percent"/>
                      </li>
                      <li>
                        Test Cases Written: <span id="test-cases"/> <span id="test-case-percent"/>
                      </li>
                      <li>
                        Tests Passing: <span id="tests-passing" /> <span id="test-pass-percent"/>
                      </li>
                    </ul>
                  </p>
                </div>
              </div>

              <div class="card info-card" style="width: 39rem;">
                <div class="card-body">
                  <h5 class="card-title">Current Focus</h5>
                  <p class="card-text">
                    The current focus is on implementing Discount Expense credits for Cubesmart.
                  </p>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="card info-card" style="width: 95%;">
                <div class="card-body">
                  <div id="chartContainer" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>

    </div>


    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <!-- More jQuery, and Chart.js-->
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.4.4.min.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/series-label.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
  </body>

  <script id='script'>
  (function() {
      $('#sidebarCollapse').click(function () {
          $('#sidebar').toggleClass('active');
      });

// Rip info from spreadsheet
      use_case_count = {};
      test_case_count = {};
      test_pass_count = {};
      $.getJSON("https://spreadsheets.google.com/feeds/list/1Udy2fXDDuDAca6xIijNxxxZf0RjvlovmNO0azqnAl8o/od6/public/values?alt=json", function(data) {
        var entries = data.feed.entry;

        // Pull totals/%
        var use_cases = entries[0]['gsx$count']['$t']
        var use_case_percent = entries[0]['gsx$percent']['$t']
        $("#use-cases").text(use_cases);
        $("#use-case-percent").text(use_case_percent);
        var test_cases = entries[1]['gsx$count']['$t']
        var test_case_percent = entries[1]['gsx$percent']['$t']
        $("#test-cases").text(test_cases);
        $("#test-case-percent").text(test_case_percent);
        var tests_passing = entries[2]['gsx$count']['$t']
        var tests_pass_percent = entries[2]['gsx$percent']['$t']
        $("#tests-passing").text(tests_passing);
        $("#test-pass-percent").text(tests_pass_percent);
        debugger;
        var total = entries[3]['gsx$count']['$t']
        $("#total").text(total);


        // Pull each completed day
        var i;
        for (i = 0; i < entries.length; i++) {
          use_case_date = entries[i]['gsx$usecasewritten']['$t'];
          use_case_count[use_case_date] = use_case_count[use_case_date] ? use_case_count[use_case_date] + 1 : 1;

          test_case_date = entries[i]['gsx$testcasewritten']['$t'];
          test_case_count[test_case_date] = test_case_count[test_case_date] ? test_case_count[test_case_date] + 1 : 1;

          test_pass_date = entries[i]['gsx$testcasepassing']['$t'];
          test_pass_count[test_pass_date] = test_pass_count[test_pass_date] ? test_pass_count[test_pass_date] + 1 : 1;
        }

        var dates = Object.keys(use_case_count) + Object.keys(test_case_count) + Object.keys(test_pass_count);
        unique_sorted_dates = dates.filter(Boolean).filter(function(x, i, a) { return a.indexOf(x) == i }).sort(function(a,b){ return new Date(a) - new Date(b); });

        // Sum them up
        var use_case_sum = 0;
        var use_case_data = unique_sorted_dates.map(function(key) {
          use_case_sum += use_case_count[key] || 0;
          return [Date.parse(key), use_case_sum];
        });
        var test_case_sum = 0;
        var test_case_data = unique_sorted_dates.map(function(key) {
          test_case_sum += test_case_count[key] || 0;
          return [Date.parse(key), test_case_sum];
        });
        var test_pass_sum = 0;
        var test_pass_data = unique_sorted_dates.map(function(key) {
          test_pass_sum += test_pass_count[key] || 0;
          return [Date.parse(key), test_pass_sum];
        });

        // Chart that shit
        Highcharts.chart('chartContainer', {
            chart: {
                type: 'spline'
            },
            title: {
                text: 'Progression of Use Cases'
            },
            subtitle: {
                text: ''
            },
            xAxis: {
                type: 'datetime',
                dateTimeLabelFormats: {
                    month: '%e. %b',
                    year: '%b'
                },
                title: {
                    text: 'Date Completed'
                }
            },
            yAxis: {
                title: {
                    text: 'Number completed'
                },
                min: 0,
                max: 250
            },
            tooltip: {
                headerFormat: '<b>{series.name}</b><br>',
                pointFormat: '{point.x:%e. %b}: {point.y}'
            },

            plotOptions: {
                spline: {
                    marker: {
                        enabled: true
                    }
                }
            },

            colors: ['#6CF', '#39F', '#06C', '#036', '#000'],

            series: [{
                name: "Use Cases Written",
                data: use_case_data,
            }, {
                name: "Test Cases Written",
                data: test_case_data,
            }, {
                name: "Tests Passing",
                data: test_pass_data,
            }]
        });

      });

  })();
  </script>
</html>

